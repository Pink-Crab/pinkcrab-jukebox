(()=>{class t{constructor(t){this.container=t,this.tracks=[],this.queue=[],this.currentIndex=0,this.isPlaying=!1,this.isShuffle=!1,this.repeatMode="off",this.shuffledOrder=[],this.shuffleIndex=0,this.volume=.8,this.vizModes=["off","bars","oscilloscope","mirror","fire"],this.vizModeNames={off:"Off",bars:"Classic Bars",oscilloscope:"Oscilloscope",mirror:"Spectrum Mirror",fire:"Fire Bars"},this.vizMode="off",this.audioContext=null,this.analyser=null,this.animationId=null,this.vizInitialized=!1,this.vizCorsBlocked=!1,this.init()}init(){const t=this.container.dataset.tracks;if(t)try{this.tracks=JSON.parse(t)}catch(t){return void console.error("Jukebox: Failed to parse tracks data",t)}0!==this.tracks.length&&(this.cacheElements(),this.bindEvents(),this.initAudio(),this.container.classList.add("jukebox--initialized"))}cacheElements(){this.audio=this.container.querySelector(".jukebox__audio"),this.artworkImg=this.container.querySelector(".jukebox__artwork-img"),this.artworkPlaceholder=this.container.querySelector(".jukebox__artwork-placeholder"),this.vizCanvasBehind=this.container.querySelector(".jukebox__visualizer--behind"),this.vizCanvasOverlay=this.container.querySelector(".jukebox__visualizer--overlay"),this.vizToggle=this.container.querySelector(".jukebox__viz-toggle"),this.artworkToggle=this.container.querySelector(".jukebox__artwork-toggle"),this.artworkContainer=this.container.querySelector(".jukebox__artwork-container"),this.artwork=this.container.querySelector(".jukebox__artwork"),this.titleEl=this.container.querySelector(".jukebox__title"),this.artistEl=this.container.querySelector(".jukebox__artist"),this.albumEl=this.container.querySelector(".jukebox__album"),this.pageLinkEl=this.container.querySelector(".jukebox__page-link"),this.progressBar=this.container.querySelector(".jukebox__progress-bar"),this.progressFill=this.container.querySelector(".jukebox__progress-fill"),this.progressInput=this.container.querySelector(".jukebox__progress-input"),this.currentTimeEl=this.container.querySelector(".jukebox__time--current"),this.durationEl=this.container.querySelector(".jukebox__time--duration"),this.playBtn=this.container.querySelector(".jukebox__btn--play"),this.prevBtn=this.container.querySelector(".jukebox__btn--prev"),this.nextBtn=this.container.querySelector(".jukebox__btn--next"),this.shuffleBtn=this.container.querySelector(".jukebox__btn--shuffle"),this.repeatBtn=this.container.querySelector(".jukebox__btn--repeat"),this.volumeBtn=this.container.querySelector(".jukebox__btn--volume"),this.volumeSlider=this.container.querySelector(".jukebox__volume-slider"),this.volumeFill=this.container.querySelector(".jukebox__volume-fill"),this.volumeInput=this.container.querySelector(".jukebox__volume-input"),this.filterInput=this.container.querySelector(".jukebox__filter-input"),this.filterActiveBar=this.container.querySelector(".jukebox__filter-active"),this.filterActiveValue=this.container.querySelector(".jukebox__filter-active-value"),this.filterClearBtn=this.container.querySelector(".jukebox__filter-clear"),this.activeFilter=null,this.tracklistEl=this.container.querySelector(".jukebox__tracks"),this.trackItems=this.container.querySelectorAll(".jukebox__track"),this.tracklistCount=this.container.querySelector(".jukebox__tracklist-count"),this.queueEl=this.container.querySelector(".jukebox__queue"),this.queueList=this.container.querySelector(".jukebox__queue-list"),this.queueToggle=this.container.querySelector(".jukebox__queue-toggle"),this.queueCount=this.container.querySelector(".jukebox__queue-count"),this.queueClear=this.container.querySelector(".jukebox__queue-clear"),this.queueClose=this.container.querySelector(".jukebox__queue-close")}bindEvents(){this.playBtn&&this.playBtn.addEventListener("click",()=>this.togglePlay()),this.prevBtn&&this.prevBtn.addEventListener("click",()=>this.previous()),this.nextBtn&&this.nextBtn.addEventListener("click",()=>this.next()),this.shuffleBtn&&this.shuffleBtn.addEventListener("click",()=>this.toggleShuffle()),this.repeatBtn&&this.repeatBtn.addEventListener("click",()=>this.toggleRepeat()),this.progressInput&&this.progressInput.addEventListener("input",t=>this.seek(t.target.value)),this.volumeBtn&&this.volumeBtn.addEventListener("click",()=>this.toggleMute()),this.volumeInput&&this.volumeInput.addEventListener("input",t=>this.setVolume(t.target.value/100)),this.audio&&(this.audio.addEventListener("timeupdate",()=>this.updateProgress()),this.audio.addEventListener("loadedmetadata",()=>this.updateDuration()),this.audio.addEventListener("ended",()=>this.handleEnded()),this.audio.addEventListener("play",()=>this.updatePlayState(!0)),this.audio.addEventListener("pause",()=>this.updatePlayState(!1)),this.audio.addEventListener("error",t=>this.handleError(t))),this.filterInput&&this.filterInput.addEventListener("input",t=>{this.clearActiveFilter(!1),this.filterTracks(t.target.value)}),this.container.querySelectorAll(".jukebox__filter-link").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const i=t.dataset.filterType,s=t.dataset.filterValue;s&&this.setActiveFilter(i,s)})}),this.filterClearBtn&&this.filterClearBtn.addEventListener("click",()=>this.clearActiveFilter(!0)),this.trackItems&&this.trackItems.forEach((t,e)=>{t.addEventListener("click",t=>{t.target.closest(".jukebox__track-btn--queue")||this.playTrack(e)});const i=t.querySelector(".jukebox__track-btn--queue");i&&i.addEventListener("click",t=>{t.stopPropagation(),this.addToQueue(e)})}),this.queueToggle&&this.queueToggle.addEventListener("click",()=>this.toggleQueuePanel()),this.queueClear&&this.queueClear.addEventListener("click",()=>this.clearQueue()),this.queueClose&&this.queueClose.addEventListener("click",()=>this.toggleQueuePanel()),this.container.addEventListener("keydown",t=>this.handleKeyboard(t)),this.vizToggle&&this.vizToggle.addEventListener("click",()=>this.cycleVisualizerMode()),this.artworkToggle&&this.artworkToggle.addEventListener("click",()=>this.toggleArtwork())}initAudio(){this.audio||(this.audio=document.createElement("audio"),this.audio.className="jukebox__audio",this.audio.preload="metadata",this.container.querySelector(".jukebox__player").appendChild(this.audio),this.audio.addEventListener("timeupdate",()=>this.updateProgress()),this.audio.addEventListener("loadedmetadata",()=>this.updateDuration()),this.audio.addEventListener("ended",()=>this.handleEnded()),this.audio.addEventListener("play",()=>this.updatePlayState(!0)),this.audio.addEventListener("pause",()=>this.updatePlayState(!1))),this.audio.volume=this.volume,this.updateVolumeDisplay(),this.tracks[0]&&this.loadTrack(0,!1)}loadTrack(t,e=!0){if(t<0||t>=this.tracks.length)return;const i=this.tracks[t];this.currentIndex=t,this.audio&&i.url&&(this.audio.src=i.url,this.audio.load()),this.checkVisualizerAvailability(),this.updateTrackDisplay(i),this.updateArtworkButtonState(),this.updateActiveTrack(t),e&&this.audio&&this.audio.play().catch(t=>{console.log("Jukebox: Auto-play prevented",t)})}updateTrackDisplay(t){this.artworkImg&&this.artworkPlaceholder&&(t.cover?(this.artworkImg.src=t.cover,this.artworkImg.alt=t.album||t.title||"",this.artworkImg.style.display="block",this.artworkPlaceholder.style.display="none"):(this.artworkImg.style.display="none",this.artworkPlaceholder.style.display="flex")),this.titleEl&&(this.titleEl.textContent=t.title||"Unknown Track"),this.artistEl&&(this.artistEl.textContent=t.artist||"",this.artistEl.classList.contains("jukebox__filter-link")&&(this.artistEl.dataset.filterValue=t.artist||"")),this.albumEl&&(this.albumEl.textContent=t.album||"",this.albumEl.classList.contains("jukebox__filter-link")&&(this.albumEl.dataset.filterValue=t.album||"",this.albumEl.style.display=t.album?"":"none")),this.pageLinkEl&&(t.pageLink?(this.pageLinkEl.href=t.pageLink,this.pageLinkEl.style.display="inline-block"):this.pageLinkEl.style.display="none"),this.progressFill&&(this.progressFill.style.width="0%"),this.progressInput&&(this.progressInput.value=0),this.currentTimeEl&&(this.currentTimeEl.textContent="0:00"),this.durationEl&&(this.durationEl.textContent="0:00")}updateActiveTrack(t){this.trackItems&&this.trackItems.forEach((e,i)=>{e.classList.toggle("jukebox__track--active",i===t)})}togglePlay(){this.audio&&(this.isPlaying?this.audio.pause():this.audio.play().catch(t=>{console.log("Jukebox: Play failed",t)}))}playTrack(t){this.loadTrack(t,!0)}previous(){if(this.isShuffle)this.shuffleIndex=Math.max(0,this.shuffleIndex-1),this.loadTrack(this.shuffledOrder[this.shuffleIndex],!0);else{const t=this.currentIndex>0?this.currentIndex-1:this.tracks.length-1;this.loadTrack(t,!0)}}next(){if(this.queue.length>0){const t=this.queue.shift();return this.updateQueueDisplay(),void this.loadTrack(t,!0)}if(this.isShuffle){if(this.shuffleIndex++,this.shuffleIndex>=this.shuffledOrder.length){if("all"!==this.repeatMode)return void(this.shuffleIndex=this.shuffledOrder.length-1);this.generateShuffleOrder(),this.shuffleIndex=0}this.loadTrack(this.shuffledOrder[this.shuffleIndex],!0)}else{const t=(this.currentIndex+1)%this.tracks.length;if(0===t&&"off"===this.repeatMode)return void this.loadTrack(t,!1);this.loadTrack(t,!0)}}handleEnded(){"one"===this.repeatMode?(this.audio.currentTime=0,this.audio.play()):this.next()}toggleShuffle(){this.isShuffle=!this.isShuffle,this.shuffleBtn&&(this.shuffleBtn.classList.toggle("jukebox__btn--active",this.isShuffle),this.shuffleBtn.setAttribute("aria-pressed",this.isShuffle)),this.isShuffle&&this.generateShuffleOrder()}generateShuffleOrder(){this.shuffledOrder=[...Array(this.tracks.length).keys()];for(let t=this.shuffledOrder.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[this.shuffledOrder[t],this.shuffledOrder[e]]=[this.shuffledOrder[e],this.shuffledOrder[t]]}const t=this.shuffledOrder.indexOf(this.currentIndex);t>0&&(this.shuffledOrder.splice(t,1),this.shuffledOrder.unshift(this.currentIndex)),this.shuffleIndex=0}toggleRepeat(){const t=["off","all","one"],e=t.indexOf(this.repeatMode);this.repeatMode=t[(e+1)%t.length],this.repeatBtn&&(this.repeatBtn.dataset.repeatMode=this.repeatMode,this.repeatBtn.classList.toggle("jukebox__btn--active","off"!==this.repeatMode))}seek(t){if(!this.audio||!this.audio.duration)return;const e=t/100*this.audio.duration;this.audio.currentTime=e}updateProgress(){if(!this.audio||!this.audio.duration)return;const t=this.audio.currentTime/this.audio.duration*100;this.progressFill&&(this.progressFill.style.width=`${t}%`),this.progressInput&&(this.progressInput.value=t),this.currentTimeEl&&(this.currentTimeEl.textContent=this.formatTime(this.audio.currentTime))}updateDuration(){this.audio&&this.audio.duration&&this.durationEl&&(this.durationEl.textContent=this.formatTime(this.audio.duration))}updatePlayState(t){this.isPlaying=t,this.playBtn&&(this.playBtn.classList.toggle("jukebox__btn--playing",t),this.playBtn.setAttribute("aria-label",t?"Pause":"Play")),this.container.classList.toggle("jukebox--playing",t)}setVolume(t){this.volume=Math.max(0,Math.min(1,t)),this.audio&&(this.audio.volume=this.volume,this.audio.muted=!1),this.updateVolumeDisplay()}toggleMute(){this.audio&&(this.audio.muted=!this.audio.muted,this.updateVolumeDisplay())}updateVolumeDisplay(){const t=this.audio?.muted||0===this.volume,e=t?0:100*this.volume;this.volumeFill&&(this.volumeFill.style.width=`${e}%`),this.volumeInput&&(this.volumeInput.value=e),this.volumeBtn&&this.volumeBtn.classList.toggle("jukebox__btn--muted",t)}filterTracks(t){const e=t.toLowerCase().trim();if(!this.trackItems)return;let i=0;this.trackItems.forEach((t,s)=>{const a=this.tracks[s],o=`${a.title} ${a.artist} ${a.album}`.toLowerCase(),r=!e||o.includes(e);t.style.display=r?"":"none",r&&i++}),this.tracklistCount&&(this.tracklistCount.textContent=i)}setActiveFilter(t,e){if(this.activeFilter={type:t,value:e},this.filterInput&&(this.filterInput.value=""),this.filterActiveBar&&this.filterActiveBar.classList.add("is-visible"),this.filterActiveValue&&(this.filterActiveValue.textContent=`${"artist"===t?"Artist":"Album"}: ${e}`),!this.trackItems)return;let i=0;this.trackItems.forEach((s,a)=>{const o=this.tracks[a],r="artist"===t?o.artist:o.album,l=r&&r.toLowerCase()===e.toLowerCase();s.style.display=l?"":"none",l&&i++}),this.tracklistCount&&(this.tracklistCount.textContent=i),this.tracklistEl&&this.tracklistEl.scrollIntoView({behavior:"smooth",block:"nearest"})}clearActiveFilter(t=!0){this.activeFilter=null,this.filterActiveBar&&this.filterActiveBar.classList.remove("is-visible"),t&&this.trackItems&&(this.trackItems.forEach(t=>{t.style.display=""}),this.tracklistCount&&(this.tracklistCount.textContent=this.tracks.length))}addToQueue(t){if(t===this.currentIndex)return void this.showToast("Already playing this track");const e=this.queue.indexOf(t);if(-1!==e){this.queue.splice(e,1),this.updateQueueDisplay(),this.updateQueueButtonStates();const i=this.tracks[t];return void this.showToast(`Removed "${i.title}" from queue`)}this.queue.push(t),this.updateQueueDisplay(),this.updateQueueButtonStates();const i=this.tracks[t];this.showToast(`Added "${i.title}" to queue`)}removeFromQueue(t){this.queue.splice(t,1),this.updateQueueDisplay(),this.updateQueueButtonStates()}clearQueue(){this.queue=[],this.updateQueueDisplay(),this.updateQueueButtonStates()}updateQueueButtonStates(){this.trackItems&&this.trackItems.forEach((t,e)=>{const i=t.querySelector(".jukebox__track-btn--queue");if(i){const t=this.queue.includes(e);i.classList.toggle("jukebox__track-btn--queued",t);const s=i.querySelector(".jukebox__track-btn-text");s&&(s.textContent=t?"Queued":"Queue")}})}toggleQueuePanel(){if(!this.queueEl)return;const t=this.queueEl.classList.toggle("jukebox__queue--hidden");this.queueToggle&&this.queueToggle.setAttribute("aria-expanded",!t),t?this.removeClickOutsideListener():setTimeout(()=>{this.handleClickOutsideQueue=t=>{this.queueEl.contains(t.target)||this.queueToggle.contains(t.target)||this.closeQueuePanel()},this.handleEscapeQueue=t=>{"Escape"===t.key&&this.closeQueuePanel()},document.addEventListener("click",this.handleClickOutsideQueue),document.addEventListener("keydown",this.handleEscapeQueue)},0)}closeQueuePanel(){this.queueEl&&(this.queueEl.classList.add("jukebox__queue--hidden"),this.queueToggle&&this.queueToggle.setAttribute("aria-expanded","false"),this.removeClickOutsideListener())}removeClickOutsideListener(){this.handleClickOutsideQueue&&(document.removeEventListener("click",this.handleClickOutsideQueue),this.handleClickOutsideQueue=null),this.handleEscapeQueue&&(document.removeEventListener("keydown",this.handleEscapeQueue),this.handleEscapeQueue=null)}updateQueueDisplay(){this.queueCount&&(this.queueCount.textContent=this.queue.length),this.queueList&&(this.queueList.innerHTML=this.queue.map((t,e)=>{const i=this.tracks[t];return`\n\t\t\t\t\t\t<li class="jukebox__queue-item" data-queue-index="${e}">\n\t\t\t\t\t\t\t<div class="jukebox__queue-item-info">\n\t\t\t\t\t\t\t\t<span class="jukebox__queue-item-title">${this.escapeHtml(i.title)}</span>\n\t\t\t\t\t\t\t\t<span class="jukebox__queue-item-artist">${this.escapeHtml(i.artist)}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\t\tclass="jukebox__queue-item-remove" \n\t\t\t\t\t\t\t\taria-label="Remove from queue"\n\t\t\t\t\t\t\t\tdata-queue-index="${e}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg viewBox="0 0 24 24" fill="currentColor">\n\t\t\t\t\t\t\t\t\t<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t`}).join(""),this.queueList.querySelectorAll(".jukebox__queue-item-remove").forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation();const i=parseInt(t.dataset.queueIndex,10);this.removeFromQueue(i)})})),this.queueEl&&this.queueEl.classList.toggle("jukebox__queue--empty",0===this.queue.length)}showToast(t){const e=this.container.querySelector(".jukebox__toast");e&&e.remove();const i=document.createElement("div");i.className="jukebox__toast",i.textContent=t,this.container.appendChild(i),requestAnimationFrame(()=>{i.classList.add("jukebox__toast--visible")}),setTimeout(()=>{i.classList.remove("jukebox__toast--visible"),setTimeout(()=>i.remove(),300)},2e3)}handleKeyboard(t){if(this.container.contains(document.activeElement))switch(t.key){case" ":t.preventDefault(),this.togglePlay();break;case"ArrowLeft":t.shiftKey?this.previous():this.audio&&(this.audio.currentTime=Math.max(0,this.audio.currentTime-5));break;case"ArrowRight":t.shiftKey?this.next():this.audio&&(this.audio.currentTime=Math.min(this.audio.duration,this.audio.currentTime+5));break;case"ArrowUp":t.preventDefault(),this.setVolume(this.volume+.1);break;case"ArrowDown":t.preventDefault(),this.setVolume(this.volume-.1);break;case"m":case"M":this.toggleMute();break;case"s":case"S":this.toggleShuffle();break;case"r":case"R":this.toggleRepeat()}}handleError(t){console.error("Jukebox: Audio error",t),this.showToast("Error loading audio")}formatTime(t){return isNaN(t)||!isFinite(t)?"0:00":`${Math.floor(t/60)}:${Math.floor(t%60).toString().padStart(2,"0")}`}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}cycleVisualizerMode(){if(this.vizCorsBlocked&&"off"===this.vizMode)return void this.showToast("Visualizer unavailable (cross-origin audio)");const t=(this.vizModes.indexOf(this.vizMode)+1)%this.vizModes.length;this.setVisualizerMode(this.vizModes[t])}setVisualizerMode(t){this.vizMode=t,this.vizToggle&&(this.vizToggle.dataset.vizMode=this.vizMode,this.vizToggle.title=`Visualizer: ${this.vizModeNames[this.vizMode]||t}`,this.vizToggle.classList.toggle("jukebox__sidebar-btn--active","off"!==this.vizMode)),this.container.dataset.vizMode=this.vizMode,"off"===this.vizMode?this.stopVisualizer():this.startVisualizer()}checkVisualizerAvailability(){const t=this.tracks[this.currentIndex],e=t&&this.isSameOrigin(t.url);this.vizCorsBlocked=!e,this.vizToggle&&(this.vizToggle.classList.toggle("jukebox__sidebar-btn--disabled",this.vizCorsBlocked),this.vizToggle.title=this.vizCorsBlocked?"Visualizer unavailable (cross-origin)":`Visualizer: ${this.vizModeNames[this.vizMode]||this.vizMode}`),this.vizCorsBlocked&&"off"!==this.vizMode&&(this.vizMode="off",this.stopVisualizer(),this.container.dataset.vizMode="off",this.vizToggle&&(this.vizToggle.dataset.vizMode="off",this.vizToggle.classList.remove("jukebox__sidebar-btn--active")))}toggleArtwork(){if(!this.artwork)return;const t=this.artwork.classList.toggle("jukebox__artwork--hidden");this.artworkToggle&&(this.artworkToggle.classList.toggle("jukebox__sidebar-btn--active",!t),this.artworkToggle.setAttribute("aria-pressed",!t),this.artworkToggle.title=t?"Show Artwork":"Hide Artwork")}updateArtworkButtonState(){const t=this.tracks[this.currentIndex],e=t&&t.cover;this.artworkToggle&&(this.artworkToggle.disabled=!e,this.artworkToggle.classList.toggle("jukebox__sidebar-btn--disabled",!e),this.artworkToggle.title=e?this.artwork?.classList.contains("jukebox__artwork--hidden")?"Show Artwork":"Hide Artwork":"No artwork available")}isSameOrigin(t){if(!t)return!1;try{return new URL(t,window.location.href).origin===window.location.origin}catch(t){return!1}}initAudioContext(){if(this.vizInitialized)return!0;const t=this.tracks[this.currentIndex];if(t&&!this.isSameOrigin(t.url))return console.info("Jukebox: Visualizer disabled for cross-origin audio (would mute)"),this.vizCorsBlocked=!0,!1;try{return this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=256,this.analyser.smoothingTimeConstant=.8,this.audioContext.createMediaElementSource(this.audio).connect(this.analyser),this.analyser.connect(this.audioContext.destination),this.vizInitialized=!0,this.vizCorsBlocked=!1,!0}catch(t){return console.warn("Jukebox: Could not initialize audio visualizer",t),this.vizCorsBlocked=!0,!1}}startVisualizer(){this.initAudioContext()?("suspended"===this.audioContext.state&&this.audioContext.resume(),this.setupVisualizerCanvas(),this.animateVisualizer()):this.vizCorsBlocked&&(this.showToast("Visualizer unavailable (cross-origin audio)"),this.vizMode="off",this.container.dataset.vizMode="off",this.vizSelect&&(this.vizSelect.value="off"))}stopVisualizer(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.clearVisualizerCanvas()}setupVisualizerCanvas(){const t=this.container.querySelector(".jukebox__artwork");if(!t)return;const e=t.getBoundingClientRect();[this.vizCanvasBehind,this.vizCanvasOverlay].forEach(t=>{t&&(t.width=e.width*window.devicePixelRatio,t.height=e.height*window.devicePixelRatio,t.style.width=e.width+"px",t.style.height=e.height+"px",t.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio))})}clearVisualizerCanvas(){[this.vizCanvasBehind,this.vizCanvasOverlay].forEach(t=>{t&&t.getContext("2d").clearRect(0,0,t.width,t.height)})}animateVisualizer(){if("off"===this.vizMode)return;this.animationId=requestAnimationFrame(()=>this.animateVisualizer());const t=this.analyser.frequencyBinCount,e=new Uint8Array(t);"oscilloscope"===this.vizMode?this.analyser.getByteTimeDomainData(e):this.analyser.getByteFrequencyData(e);const i=this.vizCanvasBehind;if(!i)return;const s=i.getContext("2d"),a=i.width/window.devicePixelRatio,o=i.height/window.devicePixelRatio;switch(s.clearRect(0,0,a,o),this.vizMode){case"bars":this.drawClassicBars(s,e,a,o);break;case"oscilloscope":this.drawOscilloscope(s,e,a,o);break;case"mirror":this.drawMirrorBars(s,e,a,o);break;case"fire":this.drawFireBars(s,e,a,o)}}drawClassicBars(t,e,i,s){const a=i/32-2;for(let i=0;i<32;i++){const o=e[Math.floor(i*e.length/32)]/255*s,r=i*(a+2),l=s-o,n=t.createLinearGradient(r,s,r,l);n.addColorStop(0,"#00ff00"),n.addColorStop(.5,"#ffff00"),n.addColorStop(1,"#ff0000"),t.fillStyle=n,t.fillRect(r,l,a,o),t.shadowColor="#00ff00",t.shadowBlur=10}t.shadowBlur=0}drawOscilloscope(t,e,i,s){t.lineWidth=2,t.strokeStyle="#00ff00",t.shadowColor="#00ff00",t.shadowBlur=10,t.beginPath();const a=i/e.length;let o=0;for(let i=0;i<e.length;i++){const r=e[i]/128*s/2;0===i?t.moveTo(o,r):t.lineTo(o,r),o+=a}t.lineTo(i,s/2),t.stroke(),t.shadowBlur=0}drawMirrorBars(t,e,i,s){const a=i/32-2,o=s/2;for(let i=0;i<32;i++){const r=e[Math.floor(i*e.length/32)]/255*(s/2),l=i*(a+2),n=t.createLinearGradient(l,o,l,o-r);n.addColorStop(0,"#e94560"),n.addColorStop(1,"#ff6b9d"),t.fillStyle=n,t.fillRect(l,o-r,a,r),t.globalAlpha=.5,t.fillRect(l,o,a,r),t.globalAlpha=1}}drawFireBars(t,e,i,s){const a=i/48-1;for(let i=0;i<48;i++){const o=e[Math.floor(i*e.length/48)]/255*s,r=i*(a+1),l=s-o,n=t.createLinearGradient(r,s,r,l);n.addColorStop(0,"#330000"),n.addColorStop(.3,"#ff3300"),n.addColorStop(.6,"#ff9900"),n.addColorStop(.85,"#ffff00"),n.addColorStop(1,"#ffffff"),t.fillStyle=n,t.fillRect(r,l,a,o)}t.shadowColor="#ff6600",t.shadowBlur=20+10*Math.random(),t.shadowBlur=0}}function e(){document.querySelectorAll(".jukebox:not(.jukebox--initialized)").forEach(e=>{new t(e)})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()})();